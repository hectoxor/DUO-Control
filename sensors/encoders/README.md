# Кодировщики

### Что такое кодировщик?

Кодер - это что-либо (устройство, программное обеспечение, человек), которое _преобразует_ информацию из одного формата в другой. Некоторые примеры кодирования включают:&#x20;

* Преобразователь, например динамик, который _преобразует_ электрический сигнал в звуковые волны.
* Программное обеспечение, которое _кодирует_ аудиофайл в mp3 для уменьшения размера файла.
* Стенографист (судебный репортер) записывает диалог в зале суда и _преобразует_ его в письменную запись.

Этот раздел посвящен поворотным энкодерам, которые представляют собой электромеханические устройства, преобразующие угловое положение вала, например, двигателя, в электронный сигнал. Эти сигналы могут быть поданы в микроконтроллер, который управляет всеми функциями робота, а затем использованы для получения данных из реального мира для принятия лучших программных решений.

Существует два основных типа энкодеров: абсолютные и относительные.

**Абсолютные энкодеры** возвращают фактический угол поворота (например, 30°). Абсолютные энкодеры сохраняют информацию о положении при отключении питания, и данные о положении сразу же становятся доступными при повторном подаче питания, причем для считывания текущего угла поворота не требуется вращения. Связь между значением энкодера и валом двигателя устанавливается при сборке и всегда остается неизменной. Обычно в таких энкодерах используется диск со специальным печатным рисунком, который считывается и преобразуется в известный угол. Как правило, абсолютные энкодеры проще использовать при программировании, но они сложнее в производстве, поэтому имеют большие размеры и более дороги.

**Относительные энкодеры**, которые также называют **инкрементными энкодерами**, предоставляют информацию о движении вала (например, вперед со скоростью 5 об/мин) и предоставляют данные только во время вращения вала. Запомнить это можно следующим образом: относительные энкодеры предоставляют информацию о приращении выходного вала двигателя. Относительные энкодеры выдают импульсы только при вращении двигателя, и интерпретация этих импульсов в полезную информацию должна осуществляться извне. Относительный энкодер не знает, в каком положении он находится при запуске, но можно создать программу калибровки, которая должна запускаться при каждом запуске, чтобы получить опорную точку для расчета угла.

Энкодеры измеряют изменения в реальном мире (вращение вала) и преобразуют их в электрический сигнал. Два распространенных способа сделать это - использовать оптическую или магнитную обратную связь:

**Оптические энкодеры** имеют диск с рядом прорезей или отражающим рисунком вокруг внешней стороны, который крепится к валу двигателя. Свет светит на диск или сквозь него, где свет может проходить или отражаться на фотодиоде (устройство, которое производит электрический сигнал, когда на него светит свет). Эти датчики могут быть очень легкими и компактными, но могут быть очень чувствительны ко всему, что может помешать свету, попадающему на фотодиод. Помехой могут стать отпечатки пальцев на отражающем диске или пыль из грязной среды.

**Магнитные энкодеры** имеют магнит, прикрепленный к валу двигателя, и используют датчики на эффекте Холла для обнаружения изменения магнитного поля при вращении вала. Магнитные энкодеры могут работать в жестких или грязных условиях.

### Магнитные квадратурные энкодеры

12-полюсный магнитный квадратурный энкодер установлен на задней части как HD Hex Motor, так и Core Hex Motor. Выходной вал двигателя выходит из задней части корпуса двигателя, и к валу прикреплен многополюсный постоянный магнит. Рядом с магнитом под углом 90° друг к другу установлены два датчика на эффекте Холла, обозначенные "A" и "B". Когда каждый из 12 полюсов проходит через один из датчиков эффекта Холла, это приводит к изменению магнитного поля, в результате чего датчик генерирует измеримый сигнал напряжения.

![Типичная конфигурация энкодера, установленного на задней части двигателя](https://2589213514-files.gitbook.io/\~/files/v0/b/gitbook-legacy-files/o/assets%2Fftc-control-system%2F-M7xeR0wyMXoIwV8ldL1%2F-M7xg89rN\_nO1-4JRef4%2F1.png?generation=1590172883133437\&alt=media)

Квадратурные энкодеры - это особый тип относительных энкодеров, которые имеют четыре различных состояния выхода. Если корень _quad-_ означает четыре, но в этом энкодере только два датчика, откуда взялось название? Выходы двух датчиков на эффекте Холла называются "канал А" и "канал В" соответственно; пример выхода показан ниже. За один период (T), определяемый как продолжительность одного полного цикла в повторяющейся схеме, временная диаграмма имеет четыре различных состояния (см. a, b, c и d ниже), следовательно, это квадратурный энкодер.

![Выходная временная диаграмма квадратурного кодера по часовой стрелке](https://2589213514-files.gitbook.io/\~/files/v0/b/gitbook-legacy-files/o/assets%2Fftc-control-system%2F-M7xeR0wyMXoIwV8ldL1%2F-M7xg89sYz2Fo51GcCss%2F2.png?generation=1590172883093442\&alt=media)

Смещение от канала А к каналу В происходит потому, что датчики смещены друг относительно друга на 90°. При вращении двигателя один датчик увидит изменения раньше другого. Когда вал двигателя вращается по часовой стрелке (CW), канал A будет опережать (фронт сигнала будет нарастать раньше) канал B. Когда двигатель вращается против часовой стрелки (CCW), канал A будет отставать (нарастать позже) канала B. Если бы был только один датчик, можно было бы измерить количество оборотов, но не определить направление вращения двигателя.

{% hint style="info" %}
На моторах HD Hex и Core Hex канал А опережает канал В при подаче положительного напряжения на клемму M+. Однако в реальной жизни бывает, что это не так. Различные редукторы или физическая замена проводов энкодеров каналов A и B в контроллере может изменить соотношение между каналами. Помните об этом при программировании и устранении неисправностей вашего робота.
{% endhint %}

Когда энкодер считывается микроконтроллером, два сигнала сравниваются для получения импульса увеличения или уменьшения отсчета. Эти импульсы считаются как шаги вперед (CW) или назад (CCW). Используя технические характеристики используемого энкодера, можно преобразовать счет в градусы. Эта информация может быть использована для того, чтобы привести манипулятор робота в движение на определенный угол или указать роботу определенное расстояние. Как концентратор управления, так и концентратор расширения подключаются к микроконтроллеру через порты энкодера.

### Технические характеристики энкодера Определения

{% hint style="info" %}
Между поставщиками энкодеров существуют некоторые противоречивые терминологические различия. В данном документе определен один из наиболее часто встречающихся наборов терминов, однако имейте в виду, что при сравнении спецификаций кодеров разных поставщиков термины могут отличаться по значению.
{% endhint %}

Каждый раз, когда выход проходит через все четыре различные комбинации выходных сигналов, это называется **циклом** (см. a, b, c и d ниже). Энкодеры имеют различное количество **циклов-превращений (CPR)** в зависимости от количества полюсов используемого магнита. CPR - это количество циклов, которое генерируется за один полный оборот вала энкодера.

![Цикл энкодера](https://2589213514-files.gitbook.io/\~/files/v0/b/gitbook-legacy-files/o/assets%2Fftc-control-system%2F-M7xeR0wyMXoIwV8ldL1%2F-M7xg89tWBiquGW5GS2y%2F3.png?generation=1590172883093279\&alt=media)

Пример выходного сигнала от одного полного оборота энкодера 14 CPR показан на рисунке ниже. Энкодер с числом оборотов 14 CPR можно также назвать имеющим 14 подъемов на канале A. Энкодеры устанавливаются на вал двигателя, а не на выходной вал редуктора, поэтому для двигателя с установленным понижающим редуктором это меньше, чем один полный оборот выходного вала.

![Рисунок 4: Выходной сигнал энкодера для одного оборота энкодера 14 CPR](https://2589213514-files.gitbook.io/\~/files/v0/b/gitbook-legacy-files/o/assets%2Fftc-control-system%2F-M7xeR0wyMXoIwV8ldL1%2F-M7xg89uDlCp-X9LmH23%2F4.png?generation=1590172883130729\&alt=media)

Одна из причин использования CPR для определения кодера, а не общепринятого PPR (Pulses per Revolution) заключается в том, что при декодировании сигнала кодера микроконтроллером можно выполнить декодирование 1x, 2x или 4x. При 1x декодировании микроконтроллер "считает" только нарастающий сигнал на одном канале, а при 4x декодировании каждый нарастающий или спадающий фронт для обоих каналов измеряется как "счет". Хотя 4-кратное декодирование является одним из наиболее распространенных методов, поскольку оно основано на том, как электроника декодирует сигнал от кодера, а не на самом оборудовании кодера, это не идеальный метод определения технических характеристик оборудования кодера.

Если мы предполагаем 4-кратное декодирование при интерпретации каждого цикла, микроконтроллер может считывать четыре отдельных выхода (a, b, c и d) как отдельные шаги. Таким образом, для каждого CPR контроллер может считать четыре отсчета/шага. Чтобы рассчитать количество отсчетов на один оборот вала энкодера:

$$
COUNTS PER ROTATION_(of the encoder shaft)=CPR(Cycles per rotation)×4
$$

Фактическое количество циклов на вращение выходного вала двигателя зависит от установленного редуктора;

$$
КОЛИЧЕСТВО ЦИКЛОВ НА ВРАЩЕНИЕ_(выходного вала)=CPR(Циклы на вращение)×4 ×Редукция
$$

Это может быть рассчитано в градусах на отсчет. Если предположить, что на выходе двигателя не добавляется дополнительная редукция (т.е. прямой привод), то количество градусов на отсчет рассчитывается как:

$$
DEGREESPERCOUNT=360°/COUNTSPERROTATION(oftheoutputshaft)
$$



